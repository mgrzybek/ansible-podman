[Unit]
Description={{ item.description }}
{% if item.after is defined and item.after != None %}
After=network.target {{ item.after }}
{% else %}
After=network.target
{% endif %}

[Service]
{% if podman_https_proxy is defined and podman_https_proxy != None %}
Environment="https_proxy={{ podman_https_proxy }}"
{% endif %}
{% if podman_http_proxy is defined and podman_http_proxy != None %}
Environment="http_proxy={{ podman_http_proxy }}"
{% endif %}
{% if podman_http_no_proxy is defined and podman_http_no_proxy != None %}
Environment="no_proxy={{ podman_http_no_proxy }}"
{% endif %}

ExecStart=/usr/bin/podman run \
	--name {{ item.name }} \
	{% if item.run_opts is defined and item.run_opts != None %}
	{% if item.run_opts | length > 0 %}{{ item.run_opts | regex_replace('\n$', '') }} {% endif %}
	{% endif %}
	{{ item.image }} \
	{% if item.command is defined and item.command != None %}
	{% if item.command | length > 0 %}{{ item.command }}{% endif %}
	{% endif %}
	{% if item.command_opts is defined and item.command_opts != None %}
	{% if item.command_opts | length > 0 %}{{ item.command_opts }}{% endif %}
	{% endif %}

ExecStop=/usr/bin/podman rm -f {{ item.name }}

[Install]
WantedBy=multi-user.target
Alias={{ item.name }}.service
